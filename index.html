<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PROHORECA | Professional PRO</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0e0e0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4345/4345573.png">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0e0e10;
            --surface: #161618;
            --card: #1c1c1f;
            --border: #27272a;
            --accent: #f5a623;
            --text: #f4f4f5;
            --muted: #71717a;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-top: env(safe-area-inset-top, 0px);
            --green: #10b981;
            --red: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'IBM Plex Sans', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }

        header {
            padding: calc(18px + var(--safe-top)) 20px 12px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .logo { font-size: 22px; color: var(--accent); }
        .global-badge { background: var(--accent); color: #000; padding: 2px 8px; border-radius: 12px; font-weight: 800; font-size: 11px; }

        main { flex: 1; overflow-y: auto; padding: 15px 15px 120px; position: relative; }

        /* SEARCH BAR */
        .search-container {
            margin-bottom: 15px;
            position: relative;
        }
        .search-input {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 12px 15px 12px 40px;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            outline: none;
        }
        .search-input:focus { border-color: var(--accent); }
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 16px;
        }

        /* --- TASK CONTAINER --- */
        .task-container {
            position: relative;
            margin-bottom: 10px;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        .swipe-action {
            position: absolute;
            top: 0; bottom: 0; width: 100%;
            display: flex; align-items: center;
            padding: 0 25px; font-weight: 700; font-size: 12px;
            color: white; z-index: 1;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .swipe-done { background: var(--green); justify-content: flex-start; }
        .swipe-delete { background: var(--red); justify-content: flex-end; }

        .task-card {
            background: var(--card);
            padding: 16px;
            border: 1px solid var(--border);
            border-left: 4px solid #3f3f46;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .task-info { flex: 1; padding-right: 10px; }
        .task-desc { font-size: 15px; font-weight: 500; margin-bottom: 4px; line-height: 1.4; color: #ececec; }
        .task-meta { font-size: 11px; color: var(--muted); display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        /* --- CONTACT BUTTONS --- */
        .contact-btns { display: flex; gap: 8px; align-items: center; }
        .c-btn {
            width: 36px; height: 36px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            background: #27272a; border: 1px solid var(--border);
            text-decoration: none; font-size: 16px;
        }
        .c-wa { color: #22c55e; }
        .c-tel { color: #3b82f6; }
        .c-restore { color: var(--accent); }

        /* --- CHECKBOX --- */
        .checkbox-container { width: 28px; height: 28px; flex-shrink: 0; margin-left: 4px; }
        input[type="checkbox"] {
            all: unset !important; width: 24px !important; height: 24px !important;
            background-color: #27272a !important; border: 1px solid var(--border) !important;
            border-radius: 6px !important; position: relative !important; display: block !important;
        }
        input[type="checkbox"]:checked { background-color: var(--green) !important; border-color: var(--green) !important; }
        input[type="checkbox"]:checked::after { content: '‚úì' !important; position: absolute !important; color: #000; font-size: 16px; font-weight: bold; left: 50%; top: 50%; transform: translate(-50%, -50%); }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; max-width: 500px; left: 50%; transform: translateX(-50%);
            background: var(--surface); border-top: 1px solid var(--border);
            display: flex; padding: 10px 0 calc(10px + var(--safe-bottom)); z-index: 200;
        }
        .nav-item { flex: 1; text-align: center; color: var(--muted); font-size: 10px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 4px; }

        .fab {
            position: fixed; bottom: calc(85px + var(--safe-bottom)); right: 20px;
            width: 58px; height: 58px; background: var(--accent); border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #000; border: none; z-index: 150; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: flex-end; z-index: 1000; }
        .modal-overlay.open { display: flex; }
        .modal { background: var(--surface); width: 100%; max-width: 500px; margin: 0 auto; border-radius: 24px 24px 0 0; padding: 25px 20px calc(30px + var(--safe-bottom)); }
        input:not([type="checkbox"]), select, textarea { width: 100%; background: #27272a; border: 1px solid var(--border); color: white; padding: 14px; border-radius: 12px; font-size: 16px; margin-bottom: 12px; font-family: inherit; }
        .btn-save { background: var(--accent); color: black; width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; }

        /* --- GRID --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .cat-card { background: var(--card); border: 1px solid var(--border); padding: 18px 5px; border-radius: 16px; text-align: center; position: relative; }
        .cat-card i { font-size: 24px; display: block; margin-bottom: 6px; }
        .cat-name { font-size: 10px; font-weight: bold; text-transform: uppercase; color: var(--muted); }
        .cat-badge { position: absolute; top: -5px; right: -5px; background: var(--accent); color: #000; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 800; border: 2px solid var(--bg); }

        .section-title { font-size: 12px; color: var(--accent); margin: 25px 0 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; font-weight: 700; letter-spacing: 1px; }
        .date-badge { padding: 3px 6px; border-radius: 5px; font-weight: 600; font-size: 10px; background: #27272a; color: var(--muted); }
        .overdue { color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05); }
        .today { color: #f5a623; border: 1px solid rgba(245, 166, 35, 0.3); background: rgba(245, 166, 35, 0.05); }

        .filter-btn { background: var(--card); border: 1px solid var(--border); color: var(--muted); padding: 8px 16px; border-radius: 20px; font-size: 12px; margin-right: 8px; white-space: nowrap; }
        .filter-btn.active { background: var(--accent); color: black; font-weight: 700; }
    </style>
</head>
<body>

    <header>
        <div class="logo bebas">PROHORECA <span id="header-title" style="color:var(--muted); margin-left:8px; font-size: 16px;">TIMELINE</span></div>
        <div class="header-btns">
            <div class="global-badge" id="total-count">0</div>
            <span onclick="app.showSettings()" style="font-size: 20px; cursor: pointer; padding: 5px; color: var(--muted);">‚öôÔ∏è</span>
        </div>
    </header>

    <main id="app-shell"></main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="app.setPage('timeline')">
            <span class="nav-icon">üìä</span> TIMELINE
        </div>
        <div class="nav-item" onclick="app.setPage('categories')">
            <span class="nav-icon">üóÇÔ∏è</span> KATEGORIJE
        </div>
        <div class="nav-item" onclick="app.setPage('archive')">
            <span class="nav-icon">‚úÖ</span> ARHIVA
        </div>
    </nav>

    <button class="fab" onclick="ui.openModal()">+</button>

    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target === this) ui.closeModal()">
        <div class="modal">
            <h2 class="bebas" id="modal-heading" style="margin-bottom:20px; color:var(--accent);">Zadatak</h2>
            <input type="hidden" id="task-id">
            <input type="text" id="task-desc" placeholder="Opis zadatka...">
            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                <input type="tel" id="task-phone" placeholder="Broj telefona" style="margin-bottom:0">
                <button onclick="app.pickContact()" style="background: #27272a; border:1px solid var(--border); padding: 0 15px; border-radius: 12px; font-size: 20px; color:white;">üë§</button>
            </div>
            <select id="task-cat"></select>
            <div style="display:flex; gap:10px;">
                <input type="date" id="task-date" style="flex:1">
                <select id="task-priority" style="flex:1">
                    <option value="normal">Normalno</option>
                    <option value="hitno">üö® HITNO</option>
                </select>
            </div>
            <button class="btn-save" onclick="app.saveTask()">SAƒåUVAJ</button>
            <button onclick="ui.closeModal()" style="background:none; border:none; color:var(--muted); width:100%; margin-top:15px; font-size: 13px;">ODUSTANI</button>
        </div>
    </div>

    <div class="modal-overlay" id="settings-overlay">
        <div class="modal">
            <h2 class="bebas" style="margin-bottom:20px; color:var(--accent);">Backup</h2>
            <button class="btn-save" onclick="app.exportData()" style="background: #3b82f6; color: white; margin-bottom: 10px;">üì¶ IZVEZI (Backup)</button>
            <button class="btn-save" onclick="document.getElementById('import-file').click()" style="background: #10b981; color: white;">üì• UƒåITAJ (Import)</button>
            <input type="file" id="import-file" style="display:none" onchange="app.importData(event)">
            <button onclick="document.getElementById('settings-overlay').classList.remove('open')" style="background:none; border:none; color:var(--muted); width:100%; margin-top:20px;">ZATVORI</button>
        </div>
    </div>

    <script>
        const CATS = {
            upiti: { n: 'Upiti & Ponude', i: 'üìß', c: '#3498db' },
            projekti: { n: 'Projekti & Monta≈æa', i: 'üèóÔ∏è', c: '#e67e22' },
            obilazak: { n: 'Obilazak', i: 'üöó', c: '#2ecc71' },
            proizvodnja: { n: 'Proizvodnja', i: '‚öôÔ∏è', c: '#95a5a6' }, // DODATO
            marketing: { n: 'Marketing', i: 'üì¢', c: '#1abc9c' }, // DODATO
            aqua: { n: 'Aqua', i: 'üíß', c: '#00cec9' },
            pv: { n: 'PV', i: '‚òÄÔ∏è', c: '#fdcb6e' },
            finansije: { n: 'Finansije', i: 'üí∞', c: '#f1c40f' },
            privatno: { n: 'Privatno', i: 'üè†', c: '#e84393' },
            dobavljaci: { n: 'Dobavljaƒçi', i: 'üì¶', c: '#9b59b6' },
            vozila: { n: 'Vozni park', i: 'üöö', c: '#e74c3c' },
            opsti: { n: 'Op≈°te', i: 'üìù', c: '#7f8c8d' }
        };

        let tasks = JSON.parse(localStorage.getItem('pro_tasks')) || [];
        let currentPage = 'timeline';
        let currentCat = null;
        let timelineFilter = 'sve';
        let searchQuery = ""; // Za pretragu

        const app = {
            setPage(page, cat = null) {
                currentPage = page; currentCat = cat;
                document.querySelectorAll('.nav-item').forEach((el, i) => {
                    el.classList.toggle('active', (page==='timeline' && i===0) || (['categories','category'].includes(page) && i===1) || (page==='archive' && i===2));
                });
                this.render();
            },
            async pickContact() {
                if (!('contacts' in navigator)) return alert('Nije podr≈æano.');
                try {
                    const contacts = await navigator.contacts.select(['name', 'tel'], { multiple: false });
                    if (contacts.length && contacts[0].tel.length) {
                        document.getElementById('task-phone').value = contacts[0].tel[0];
                        if (!document.getElementById('task-desc').value) document.getElementById('task-desc').value = contacts[0].name[0];
                    }
                } catch (e) {}
            },
            saveTask() {
                const desc = document.getElementById('task-desc').value.trim();
                if (!desc) return;
                const id = document.getElementById('task-id').value;
                const task = {
                    id: id || Date.now().toString(),
                    desc, phone: document.getElementById('task-phone').value,
                    cat: document.getElementById('task-cat').value,
                    date: document.getElementById('task-date').value,
                    priority: document.getElementById('task-priority').value,
                    done: false, deleted: false
                };
                if (id) {
                    const idx = tasks.findIndex(t => t.id === id);
                    task.done = tasks[idx].done;
                    task.deleted = tasks[idx].deleted;
                    tasks[idx] = task;
                } else { tasks.push(task); }
                this.sync(); ui.closeModal();
            },
            sync() { localStorage.setItem('pro_tasks', JSON.stringify(tasks)); this.render(); },
            render() {
                const shell = document.getElementById('app-shell');
                document.getElementById('total-count').innerText = tasks.filter(t => !t.done && !t.deleted).length;
                shell.innerHTML = '';
                if (currentPage === 'timeline') this.renderTimeline(shell);
                else if (currentPage === 'categories') this.renderGrid(shell);
                else if (currentPage === 'category') this.renderCategory(shell);
                else if (currentPage === 'archive') this.renderArchive(shell);
                this.initSwipe();
            },
            renderTimeline(el) {
                const today = new Date().toISOString().split('T')[0];
                let active = tasks.filter(t => !t.done && t.date && !t.deleted);
                
                // Primeni pretragu ako postoji
                if(searchQuery) {
                    active = active.filter(t => t.desc.toLowerCase().includes(searchQuery.toLowerCase()));
                }

                if(timelineFilter === 'danas') active = active.filter(t => t.date === today);
                if(timelineFilter === 'hitno') active = active.filter(t => t.priority === 'hitno');

                // SEARCH BAR HTML
                el.innerHTML = `
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Pretra≈æi klijenta ili zadatak..." value="${searchQuery}" oninput="app.handleSearch(this.value)">
                    </div>
                    <div style="display:flex; overflow-x:auto; margin-bottom:15px; padding-bottom:5px; scrollbar-width:none;">
                        <div class="filter-btn ${timelineFilter==='sve'?'active':''}" onclick="app.setFilter('sve')">Sve</div>
                        <div class="filter-btn ${timelineFilter==='danas'?'active':''}" onclick="app.setFilter('danas')">Danas</div>
                        <div class="filter-btn ${timelineFilter==='hitno'?'active':''}" onclick="app.setFilter('hitno')">üö® Hitno</div>
                    </div>
                `;

                const overdue = active.filter(t => t.date < today).sort((a,b) => a.date > b.date ? 1 : -1);
                const isToday = active.filter(t => t.date === today);
                const upcoming = active.filter(t => t.date > today).sort((a,b) => a.date > b.date ? 1 : -1);

                if (overdue.length) el.innerHTML += `<div class="section-title bebas">ISTEKLO</div>` + overdue.map(t => this.taskHTML(t)).join('');
                if (isToday.length) el.innerHTML += `<div class="section-title bebas">DANAS</div>` + isToday.map(t => this.taskHTML(t)).join('');
                if (upcoming.length) el.innerHTML += `<div class="section-title bebas">USKORO</div>` + upcoming.map(t => this.taskHTML(t)).join('');
                
                if (!active.length && searchQuery) el.innerHTML += `<div style="text-align:center; padding:40px; color:var(--muted)">Nema rezultata za "${searchQuery}"</div>`;
            },
            handleSearch(val) {
                searchQuery = val;
                this.render();
            },
            renderGrid(el) {
                let html = '<div class="grid">';
                for (let k in CATS) {
                    const c = tasks.filter(t => t.cat === k && !t.done && !t.deleted).length;
                    html += `<div class="cat-card" onclick="app.setPage('category', '${k}')">${c > 0 ? `<div class="cat-badge">${c}</div>` : ''}<i>${CATS[k].i}</i><div class="cat-name">${CATS[k].n}</div></div>`;
                }
                el.innerHTML = html + '</div>';
            },
            renderCategory(el) {
                const catTasks = tasks.filter(t => t.cat === currentCat && !t.done && !t.deleted);
                el.innerHTML = catTasks.length ? catTasks.map(t => this.taskHTML(t)).join('') : '<div style="text-align:center; padding:40px; color:var(--muted)">ƒåisto.</div>';
            },
            renderArchive(el) {
                const done = tasks.filter(t => t.done && !t.deleted);
                const deleted = tasks.filter(t => t.deleted);
                let html = '';
                if(done.length) html += `<div class="section-title bebas">ZAVR≈†ENO</div>` + done.slice(-20).reverse().map(t => this.taskHTML(t)).join('');
                if(deleted.length) html += `<div class="section-title bebas" style="color:var(--red)">SMEƒÜE</div>` + deleted.map(t => this.taskHTML(t, true)).join('');
                el.innerHTML = html || '<div style="text-align:center; padding:40px; color:var(--muted)">Prazno.</div>';
            },
            taskHTML(t, isTrash = false) {
                const today = new Date().toISOString().split('T')[0];
                const ds = t.date < today ? 'overdue' : (t.date === today ? 'today' : '');
                const days = ['Ned', 'Pon', 'Uto', 'Sre', 'ƒået', 'Pet', 'Sub'];
                const dayName = t.date ? `(${days[new Date(t.date).getDay()]})` : '';
                const cleanPhone = t.phone ? t.phone.replace(/[^0-9+]/g, '') : '';
                const waLink = `https://wa.me/${cleanPhone.startsWith('0') ? '381'+cleanPhone.substring(1) : cleanPhone}?text=${encodeURIComponent('Podsetnik: ' + t.desc)}`;

                return `
                    <div class="task-container" data-id="${t.id}">
                        ${!isTrash ? `
                            <div class="swipe-action swipe-done">GOTOVO</div>
                            <div class="swipe-action swipe-delete">OBRI≈†I</div>
                        ` : ''}
                        <div class="task-card" style="border-left-color:${CATS[t.cat].c}; opacity:${t.done || t.deleted ? 0.5 : 1}" onclick="${!t.deleted ? `ui.openModal('${t.id}')` : ''}">
                            <div class="task-info">
                                <div class="task-desc" style="${t.done || t.deleted ? 'text-decoration:line-through' : ''}">${t.desc}</div>
                                <div class="task-meta">
                                    <span style="color:${CATS[t.cat].c}; font-weight:700;">${CATS[t.cat].i}</span>
                                    ${t.date ? `<span class="date-badge ${ds}">${t.date.split('-')[2]}.${t.date.split('-')[1]}. ${dayName}</span>` : ''}
                                    ${t.priority === 'hitno' ? `<span style="color:var(--red); font-weight:bold;">üö®</span>` : ''}
                                </div>
                            </div>
                            <div class="contact-btns">
                                ${t.deleted ? `<span class="c-btn c-restore" onclick="event.stopPropagation(); app.restoreTask('${t.id}')">‚Ü©Ô∏è</span>` : ''}
                                ${t.phone && !t.deleted ? `
                                    <a href="tel:${cleanPhone}" class="c-btn c-tel" onclick="event.stopPropagation()">üìû</a>
                                    <a href="${waLink}" target="_blank" class="c-btn c-wa" onclick="event.stopPropagation()">üí¨</a>
                                ` : ''}
                                ${!t.deleted ? `
                                    <div class="checkbox-container">
                                        <input type="checkbox" ${t.done?'checked':''} onclick="event.stopPropagation(); app.toggleTask('${t.id}')">
                                    </div>
                                ` : ''}
                                ${isTrash ? `<span class="c-btn" style="color:var(--red)" onclick="event.stopPropagation(); app.permaDelete('${t.id}')">üóë</span>` : ''}
                            </div>
                        </div>
                    </div>`;
            },
            setFilter(f) { timelineFilter = f; this.render(); },
            toggleTask(id) {
                const t = tasks.find(x => x.id === id);
                if(t) { t.done = !t.done; this.sync(); }
            },
            deleteTask(id) {
                const t = tasks.find(x => x.id === id);
                if(t) { t.deleted = true; this.sync(); }
            },
            restoreTask(id) {
                const t = tasks.find(x => x.id === id);
                if(t) { t.deleted = false; this.sync(); }
            },
            permaDelete(id) {
                if(confirm('Trajno obrisati?')) {
                    tasks = tasks.filter(t => t.id !== id);
                    this.sync();
                }
            },
            exportData() {
                const dataStr = JSON.stringify(tasks);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', 'prohoreca_backup.json');
                link.click();
            },
            importData(e) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        tasks = JSON.parse(e.target.result);
                        this.sync();
                        document.getElementById('settings-overlay').classList.remove('open');
                    } catch(err) { alert('Gre≈°ka.'); }
                };
                reader.readAsText(e.target.files[0]);
            },
            showSettings() { document.getElementById('settings-overlay').classList.add('open'); },
            initSwipe() {
                if (currentPage === 'archive') return;
                document.querySelectorAll('.task-container').forEach(container => {
                    const card = container.querySelector('.task-card');
                    const doneAction = container.querySelector('.swipe-done');
                    const delAction = container.querySelector('.swipe-delete');
                    let startX = 0, currentX = 0;

                    container.addEventListener('touchstart', e => { 
                        startX = e.touches[0].clientX; 
                        card.style.transition = 'none'; 
                    }, {passive: true});

                    container.addEventListener('touchmove', e => {
                        currentX = e.touches[0].clientX - startX;
                        if (Math.abs(currentX) > 15) {
                            if (currentX > 0) { doneAction.style.opacity = 0.8; delAction.style.opacity = 0; }
                            else { doneAction.style.opacity = 0; delAction.style.opacity = 0.8; }
                        }
                        card.style.transform = `translateX(${currentX}px)`;
                    }, {passive: true});

                    container.addEventListener('touchend', () => {
                        card.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
                        const id = container.getAttribute('data-id');
                        if (currentX > 150) app.toggleTask(id);
                        else if (currentX < -150) app.deleteTask(id);
                        
                        card.style.transform = `translateX(0px)`;
                        setTimeout(() => {
                            if(doneAction) doneAction.style.opacity = 0;
                            if(delAction) delAction.style.opacity = 0;
                        }, 300);
                        currentX = 0;
                    });
                });
            }
        };

        const ui = {
            openModal(id = null) {
                const catSel = document.getElementById('task-cat');
                catSel.innerHTML = Object.entries(CATS).map(([k,v]) => `<option value="${k}" ${currentCat===k?'selected':''}>${v.i} ${v.n}</option>`).join('');
                if (id) {
                    const t = tasks.find(x => x.id === id);
                    document.getElementById('task-id').value = t.id;
                    document.getElementById('task-desc').value = t.desc;
                    document.getElementById('task-phone').value = t.phone || '';
                    document.getElementById('task-cat').value = t.cat;
                    document.getElementById('task-date').value = t.date;
                    document.getElementById('task-priority').value = t.priority;
                    document.getElementById('modal-heading').innerText = 'IZMENI';
                } else {
                    document.getElementById('task-id').value = '';
                    document.getElementById('task-desc').value = '';
                    document.getElementById('task-phone').value = '';
                    document.getElementById('task-date').value = '';
                    document.getElementById('task-priority').value = 'normal';
                    document.getElementById('modal-heading').innerText = 'NOVI ZADATAK';
                }
                document.getElementById('modal-overlay').classList.add('open');
            },
            closeModal() { document.getElementById('modal-overlay').classList.remove('open'); }
        };

        app.render();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
        }
    </script>
</body>
</html>
