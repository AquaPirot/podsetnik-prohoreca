<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PROHORECA | Podsetnik</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0e0e0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4345/4345573.png">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0e0e0f;
            --surface: #161618;
            --card: #1e1e21;
            --border: #2a2a2e;
            --accent: #f5a623;
            --text: #e8e8ea;
            --muted: #888890;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-top: env(safe-area-inset-top, 0px);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'IBM Plex Sans', sans-serif;
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }

        header {
            padding: calc(20px + var(--safe-top)) 20px 10px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { font-size: 22px; color: var(--accent); }
        .global-badge { background: var(--accent); color: #000; padding: 2px 8px; border-radius: 10px; font-weight: bold; font-size: 12px; }

        main { flex: 1; overflow-y: auto; padding: 15px 15px 120px; }

        .bottom-nav {
            position: fixed;
            bottom: 0; width: 100%; max-width: 500px;
            left: 50%; transform: translateX(-50%);
            background: var(--surface); border-top: 1px solid var(--border);
            display: flex; padding: 10px 0 calc(10px + var(--safe-bottom));
            z-index: 200;
        }

        .nav-item { flex: 1; text-align: center; color: var(--muted); font-size: 10px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 2px; }

        .fab {
            position: fixed;
            bottom: calc(85px + var(--safe-bottom));
            right: 20px; width: 60px; height: 60px;
            background: var(--accent); border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: #000; border: none; z-index: 150;
        }

        /* --- TASK CARD --- */
        .task-card {
            background: var(--card);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 6px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-info { flex: 1; padding-right: 12px; }
        .task-desc { font-size: 16px; font-weight: 500; margin-bottom: 4px; line-height: 1.3; }
        .task-meta { font-size: 11px; color: var(--muted); display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        /* --- STROGO DEFINISAN CHECKBOX --- */
        .checkbox-container {
            width: 30px !important;
            height: 30px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        input[type="checkbox"] {
            all: unset !important;
            box-sizing: border-box !important;
            width: 28px !important;
            height: 28px !important;
            min-width: 28px !important;
            min-height: 28px !important;
            max-width: 28px !important;
            max-height: 28px !important;
            background-color: #2a2a2e !important;
            border: 2px solid var(--border) !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            position: relative !important;
            display: inline-block !important;
        }

        input[type="checkbox"]:checked {
            background-color: var(--accent) !important;
            border-color: var(--accent) !important;
        }

        input[type="checkbox"]:checked::after {
            content: '‚úì' !important;
            position: absolute !important;
            color: black !important;
            font-size: 18px !important;
            font-weight: bold !important;
            left: 50% !important;
            top: 50% !important;
            transform: translate(-50%, -50%) !important;
        }

        /* --- FORM INPUTS --- */
        input:not([type="checkbox"]), select, textarea {
            width: 100%; background: var(--card); border: 1px solid var(--border);
            color: white; padding: 14px; border-radius: 12px; font-size: 16px;
        }

        /* --- GRID --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .cat-card { background: var(--card); border: 1px solid var(--border); padding: 20px 5px; border-radius: 18px; text-align: center; position: relative; }
        .cat-card i { font-size: 28px; display: block; margin-bottom: 8px; }
        .cat-name { font-size: 10px; font-weight: bold; text-transform: uppercase; color: var(--muted); }
        .cat-badge { position: absolute; top: -6px; right: -6px; background: var(--accent); color: #000; font-size: 10px; padding: 2px 7px; border-radius: 10px; font-weight: 800; border: 2px solid var(--bg); }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: none; align-items: flex-end; z-index: 1000;
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--surface); width: 100%; max-width: 500px;
            margin: 0 auto; border-radius: 30px 30px 0 0;
            padding: 30px 25px calc(35px + var(--safe-bottom));
        }

        .btn-save { background: var(--accent); color: black; width: 100%; padding: 16px; border: none; border-radius: 14px; font-weight: bold; font-size: 17px; margin-top: 10px; }
        .btn-cancel { color: var(--muted); text-align: center; display: block; margin-top: 20px; font-size: 14px; text-decoration: none; }
        
        .filters { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 20px; padding-bottom: 5px; scrollbar-width: none; }
        .filter-btn { background: var(--card); border: 1px solid var(--border); color: var(--muted); padding: 8px 18px; border-radius: 20px; font-size: 13px; white-space: nowrap; }
        .filter-btn.active { background: var(--accent); color: black; border-color: var(--accent); font-weight: bold; }

        .section-title { font-size: 14px; color: var(--accent); margin: 25px 0 12px; border-bottom: 1px solid var(--border); padding-bottom: 6px; }
        
        .date-badge { padding: 3px 7px; border-radius: 5px; font-weight: 600; font-size: 10px; background: var(--border); }
        .overdue { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }
        .today { background: rgba(245, 166, 35, 0.2); color: #f5a623; border: 1px solid #f5a623; }
    </style>
</head>
<body>

    <header>
        <div class="logo bebas">PROHORECA <span id="header-title" style="color:white; margin-left:10px;">TIMELINE</span></div>
        <div class="global-badge" id="total-count">0</div>
    </header>

    <main id="app-shell"></main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="app.setPage('timeline')">
            <span class="nav-icon">üìä</span> TIMELINE
        </div>
        <div class="nav-item" onclick="app.setPage('categories')">
            <span class="nav-icon">üóÇÔ∏è</span> KATEGORIJE
        </div>
        <div class="nav-item" onclick="app.setPage('archive')">
            <span class="nav-icon">‚úÖ</span> ARHIVA
        </div>
    </nav>

    <button class="fab" onclick="ui.openModal()">+</button>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <h2 class="bebas" id="modal-heading" style="margin-bottom:20px; color:var(--accent);">Zadatak</h2>
            <input type="hidden" id="task-id">
            <div class="form-group">
                <label>Opis</label>
                <input type="text" id="task-desc" placeholder="≈†ta treba uraditi?">
            </div>
            <div class="form-group">
                <label>Kategorija</label>
                <select id="task-cat"></select>
            </div>
            <div style="display:flex; gap:12px;">
                <div class="form-group" style="flex:1">
                    <label>Rok</label>
                    <input type="date" id="task-date">
                </div>
                <div class="form-group" style="flex:1">
                    <label>Prioritet</label>
                    <select id="task-priority">
                        <option value="normal">Normalno</option>
                        <option value="hitno">üö® HITNO</option>
                    </select>
                </div>
            </div>
            <button class="btn-save" onclick="app.saveTask()">SAƒåUVAJ</button>
            <a href="#" class="btn-cancel" onclick="ui.closeModal()">Odustani</a>
            <button id="del-btn" style="display:none; background:none; border:none; color:#e74c3c; width:100%; margin-top:25px; font-weight:600;" onclick="app.deleteTask()">Obri≈°i zadatak</button>
        </div>
    </div>

    <script>
        const CATS = {
            upiti: { n: 'Upiti & Ponude', i: 'üìß', c: '#3498db' },
            projekti: { n: 'Projekti & Monta≈æa', i: 'üèóÔ∏è', c: '#e67e22' },
            obilazak: { n: 'Obilazak', i: 'üöó', c: '#2ecc71' },
            aqua: { n: 'Aqua', i: 'üíß', c: '#00cec9' },
            pv: { n: 'PV', i: '‚òÄÔ∏è', c: '#fdcb6e' },
            proizvodnja: { n: 'Proizvodnja', i: '‚öôÔ∏è', c: '#95a5a6' },
            finansije: { n: 'Finansije', i: 'üí∞', c: '#f1c40f' },
            privatno: { n: 'Privatno', i: 'üè†', c: '#e84393' },
            dobavljaci: { n: 'Dobavljaƒçi', i: 'üì¶', c: '#9b59b6' },
            vozila: { n: 'Vozni park', i: 'üöö', c: '#e74c3c' },
            marketing: { n: 'Marketing', i: 'üì¢', c: '#1abc9c' },
            opsti: { n: 'Op≈°te', i: 'üìù', c: '#7f8c8d' }
        };

        let tasks = JSON.parse(localStorage.getItem('pro_tasks')) || [];
        let currentPage = 'timeline';
        let currentCat = null;
        let timelineFilter = 'sve';

        const app = {
            setPage(page, cat = null) {
                currentPage = page;
                currentCat = cat;
                document.querySelectorAll('.nav-item').forEach((el, i) => {
                    el.classList.toggle('active', (page === 'timeline' && i === 0) || ((page === 'categories' || page === 'category') && i === 1) || (page === 'archive' && i === 2));
                });
                this.render();
            },
            saveTask() {
                const desc = document.getElementById('task-desc').value.trim();
                if (!desc) return;
                const id = document.getElementById('task-id').value;
                const task = {
                    id: id || Date.now().toString(),
                    desc,
                    cat: document.getElementById('task-cat').value,
                    date: document.getElementById('task-date').value,
                    priority: document.getElementById('task-priority').value,
                    done: false
                };
                if (id) {
                    const idx = tasks.findIndex(t => t.id === id);
                    task.done = tasks[idx].done;
                    tasks[idx] = task;
                } else {
                    tasks.push(task);
                }
                this.sync();
                ui.closeModal();
            },
            toggleTask(id, e) {
                e.stopPropagation();
                const t = tasks.find(x => x.id === id);
                t.done = !t.done;
                this.sync();
            },
            deleteTask() {
                if (!confirm('Obrisati zadatak?')) return;
                const id = document.getElementById('task-id').value;
                tasks = tasks.filter(t => t.id !== id);
                this.sync();
                ui.closeModal();
            },
            sync() {
                localStorage.setItem('pro_tasks', JSON.stringify(tasks));
                this.render();
            },
            render() {
                const shell = document.getElementById('app-shell');
                const title = document.getElementById('header-title');
                const count = document.getElementById('total-count');
                count.innerText = tasks.filter(t => !t.done).length;
                shell.innerHTML = '';

                if (currentPage === 'timeline') {
                    title.innerText = 'TIMELINE';
                    this.renderTimeline(shell);
                } else if (currentPage === 'categories') {
                    title.innerText = 'KATEGORIJE';
                    this.renderGrid(shell);
                } else if (currentPage === 'category') {
                    title.innerText = CATS[currentCat].n.toUpperCase();
                    this.renderCategory(shell);
                } else if (currentPage === 'archive') {
                    title.innerText = 'ARHIVA';
                    this.renderArchive(shell);
                }
            },
            renderTimeline(el) {
                const today = new Date().toISOString().split('T')[0];
                let active = tasks.filter(t => !t.done && t.date);
                if(timelineFilter === 'danas') active = active.filter(t => t.date === today);
                if(timelineFilter === 'hitno') active = active.filter(t => t.priority === 'hitno');

                el.innerHTML = `
                    <div class="filters">
                        <div class="filter-btn ${timelineFilter==='sve'?'active':''}" onclick="app.setFilter('sve')">Sve</div>
                        <div class="filter-btn ${timelineFilter==='danas'?'active':''}" onclick="app.setFilter('danas')">Danas</div>
                        <div class="filter-btn ${timelineFilter==='hitno'?'active':''}" onclick="app.setFilter('hitno')">üö® Hitno</div>
                    </div>
                `;

                const overdue = active.filter(t => t.date < today).sort((a,b) => a.date > b.date ? 1 : -1);
                const isToday = active.filter(t => t.date === today);
                const upcoming = active.filter(t => t.date > today).sort((a,b) => a.date > b.date ? 1 : -1);

                if (overdue.length) el.innerHTML += `<div class="section-title bebas">ISTEKLO</div>` + overdue.map(t => this.taskHTML(t)).join('');
                if (isToday.length) el.innerHTML += `<div class="section-title bebas">DANAS</div>` + isToday.map(t => this.taskHTML(t)).join('');
                if (upcoming.length) el.innerHTML += `<div class="section-title bebas">USKORO</div>` + upcoming.map(t => this.taskHTML(t)).join('');
                if (!active.length) el.innerHTML += `<div style="text-align:center; padding:40px; color:var(--muted)">Nema zadataka.</div>`;
            },
            renderGrid(el) {
                let html = '<div class="grid">';
                for (let k in CATS) {
                    const c = tasks.filter(t => t.cat === k && !t.done).length;
                    html += `<div class="cat-card" onclick="app.setPage('category', '${k}')">${c > 0 ? `<div class="cat-badge">${c}</div>` : ''}<i>${CATS[k].i}</i><div class="cat-name">${CATS[k].n}</div></div>`;
                }
                el.innerHTML = html + '</div>';
            },
            renderCategory(el) {
                const catTasks = tasks.filter(t => t.cat === currentCat && !t.done);
                el.innerHTML = catTasks.length ? catTasks.map(t => this.taskHTML(t)).join('') : '<div style="text-align:center; padding:40px; color:var(--muted)">Prazno.</div>';
            },
            renderArchive(el) {
                const done = tasks.filter(t => t.done);
                el.innerHTML = done.length ? done.slice(-30).reverse().map(t => this.taskHTML(t)).join('') : '<div style="text-align:center; padding:40px; color:var(--muted)">Prazno.</div>';
            },
            setFilter(f) { timelineFilter = f; this.render(); },
            getDayName(dateStr) {
                const days = ['Ned', 'Pon', 'Uto', 'Sre', 'ƒået', 'Pet', 'Sub'];
                const d = new Date(dateStr);
                return days[d.getDay()];
            },
            taskHTML(t) {
                const today = new Date().toISOString().split('T')[0];
                const ds = t.date < today ? 'overdue' : (t.date === today ? 'today' : '');
                const dayName = t.date ? `(${this.getDayName(t.date)})` : '';
                return `
                    <div class="task-card" style="border-left-color:${CATS[t.cat].c}; opacity:${t.done?0.5:1}" onclick="ui.openModal('${t.id}')">
                        <div class="task-info">
                            <div class="task-desc" style="${t.done?'text-decoration:line-through':''}">${t.desc}</div>
                            <div class="task-meta">
                                <span style="color:${CATS[t.cat].c}; font-weight:600;">${CATS[t.cat].i} ${CATS[t.cat].n}</span>
                                ${t.date ? `<span class="date-badge ${ds}">${t.date.split('-')[2]}.${t.date.split('-')[1]}. ${dayName}</span>` : ''}
                                ${t.priority === 'hitno' ? `<span style="color:#e74c3c; font-weight:bold;">üö® HITNO</span>` : ''}
                            </div>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" ${t.done?'checked':''} onclick="app.toggleTask('${t.id}', event)">
                        </div>
                    </div>`;
            }
        };

        const ui = {
            openModal(id = null) {
                const catSel = document.getElementById('task-cat');
                catSel.innerHTML = Object.entries(CATS).map(([k,v]) => `<option value="${k}" ${currentCat===k?'selected':''}>${v.i} ${v.n}</option>`).join('');
                if (id) {
                    const t = tasks.find(x => x.id === id);
                    document.getElementById('task-id').value = t.id;
                    document.getElementById('task-desc').value = t.desc;
                    document.getElementById('task-cat').value = t.cat;
                    document.getElementById('task-date').value = t.date;
                    document.getElementById('task-priority').value = t.priority;
                    document.getElementById('modal-heading').innerText = 'Izmeni';
                    document.getElementById('del-btn').style.display = 'block';
                } else {
                    document.getElementById('task-id').value = '';
                    document.getElementById('task-desc').value = '';
                    document.getElementById('task-date').value = '';
                    document.getElementById('task-priority').value = 'normal';
                    document.getElementById('modal-heading').innerText = 'Novi zadatak';
                    document.getElementById('del-btn').style.display = 'none';
                }
                document.getElementById('modal-overlay').classList.add('open');
            },
            closeModal() { document.getElementById('modal-overlay').classList.remove('open'); }
        };

        app.render();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
        }
    </script>
</body>
</html>