<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROHORECA | Podsetnik</title>
    
    <!-- PWA Meta Tagovi -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0e0e0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4345/4345573.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0e0e0f;
            --surface: #161618;
            --card: #1e1e21;
            --border: #2a2a2e;
            --accent: #f5a623;
            --text: #e8e8ea;
            --muted: #888890;
            
            /* Boje kategorija */
            --cat-upiti: #3498db;
            --cat-projekti: #e67e22;
            --cat-obilazak: #2ecc71;
            --cat-dobavljaci: #9b59b6;
            --cat-proizvodnja: #95a5a6;
            --cat-finansije: #f1c40f;
            --cat-vozila: #e74c3c;
            --cat-marketing: #1abc9c;
            --cat-opsti: #7f8c8d;

            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'IBM Plex Sans', sans-serif;
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }

        /* HEADER */
        header {
            padding: 20px 20px 10px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { font-size: 22px; color: var(--accent); }
        .global-badge { background: var(--accent); color: #000; padding: 2px 8px; border-radius: 10px; font-weight: bold; font-size: 12px; }

        /* MAIN CONTENT */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 15px 15px 100px;
        }

        /* NAVIGATION */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 500px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 10px 0 calc(10px + var(--safe-bottom));
            z-index: 90;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            color: var(--muted);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
        }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }

        /* FAB */
        .fab {
            position: fixed;
            bottom: calc(80px + var(--safe-bottom));
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--accent);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: none;
            cursor: pointer;
            z-index: 80;
        }

        /* CARDS */
        .task-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 5px solid transparent;
            position: relative;
        }
        .task-desc { font-size: 16px; font-weight: 500; margin-bottom: 8px; }
        .task-meta { font-size: 12px; color: var(--muted); display: flex; gap: 12px; align-items: center; }
        .priority-hitno { color: #ff4757; font-weight: bold; }
        
        .date-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 11px;
            background: var(--border);
        }
        .overdue { background: #e74c3c; color: white; }
        .today { background: #f5a623; color: black; }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .cat-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 15px 5px;
            border-radius: 15px;
            text-align: center;
            position: relative;
        }
        .cat-card i { font-size: 24px; display: block; margin-bottom: 8px; }
        .cat-name { font-size: 10px; font-weight: bold; text-transform: uppercase; color: var(--muted); }
        .cat-badge { position: absolute; top: -5px; right: -5px; background: var(--accent); color: #000; font-size: 10px; padding: 2px 6px; border-radius: 10px; }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: flex-end;
            z-index: 1000;
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--surface);
            width: 100%;
            border-radius: 25px 25px 0 0;
            padding: 25px;
            padding-bottom: calc(30px + var(--safe-bottom));
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 11px; color: var(--muted); margin-bottom: 5px; text-transform: uppercase; }
        input, select, textarea {
            width: 100%; background: var(--card); border: 1px solid var(--border);
            color: white; padding: 12px; border-radius: 10px; font-size: 16px;
        }
        .btn-save { background: var(--accent); color: black; width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn-cancel { color: var(--muted); text-align: center; display: block; margin-top: 15px; font-size: 14px; text-decoration: none; }
        
        /* FILTERS */
        .filters { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; }
        .filter-btn { background: var(--card); border: 1px solid var(--border); color: var(--muted); padding: 6px 15px; border-radius: 20px; font-size: 12px; white-space: nowrap; }
        .filter-btn.active { background: var(--accent); color: black; border-color: var(--accent); }

        .section-title { font-size: 14px; color: var(--accent); margin: 20px 0 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
    </style>
</head>
<body>

    <header>
        <div class="logo bebas">PROHORECA <span id="header-title" style="color:white; margin-left:10px;">TIMELINE</span></div>
        <div class="global-badge" id="total-count">0</div>
    </header>

    <main id="app-shell"></main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="app.setPage('timeline')">
            <span class="nav-icon">üìä</span> TIMELINE
        </div>
        <div class="nav-item" onclick="app.setPage('categories')">
            <span class="nav-icon">üóÇÔ∏è</span> KATEGORIJE
        </div>
        <div class="nav-item" onclick="app.setPage('archive')">
            <span class="nav-icon">‚úÖ</span> ARHIVA
        </div>
    </nav>

    <button class="fab" onclick="ui.openModal()">+</button>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <h2 class="bebas" id="modal-heading" style="margin-bottom:20px;">Novi Zadatak</h2>
            <input type="hidden" id="task-id">
            
            <div class="form-group">
                <label>Opis</label>
                <input type="text" id="task-desc" placeholder="≈†ta treba uraditi?">
            </div>
            <div class="form-group">
                <label>Kategorija</label>
                <select id="task-cat"></select>
            </div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1">
                    <label>Rok</label>
                    <input type="date" id="task-date">
                </div>
                <div class="form-group" style="flex:1">
                    <label>Prioritet</label>
                    <select id="task-priority">
                        <option value="normal">Normalno</option>
                        <option value="hitno">üö® Hitno</option>
                    </select>
                </div>
            </div>
            <button class="btn-save" onclick="app.saveTask()">SAƒåUVAJ</button>
            <a href="#" class="btn-cancel" onclick="ui.closeModal()">Odustani</a>
            <button id="del-btn" style="display:none; background:none; border:none; color:red; width:100%; margin-top:20px;" onclick="app.deleteTask()">Obri≈°i zadatak</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const CATS = {
            upiti: { n: 'Upiti & Ponude', i: 'üìß', c: '#3498db' },
            projekti: { n: 'Projekti & Monta≈æa', i: 'üèóÔ∏è', c: '#e67e22' },
            obilazak: { n: 'Obilazak', i: 'üöó', c: '#2ecc71' },
            dobavljaci: { n: 'Dobavljaƒçi', i: 'üì¶', c: '#9b59b6' },
            proizvodnja: { n: 'Proizvodnja', i: '‚öôÔ∏è', c: '#95a5a6' },
            finansije: { n: 'Finansije', i: 'üí∞', c: '#f1c40f' },
            vozila: { n: 'Vozni park', i: 'üöö', c: '#e74c3c' },
            marketing: { n: 'Marketing', i: 'üì¢', c: '#1abc9c' },
            opsti: { n: 'Op≈°te', i: 'üìù', c: '#7f8c8d' }
        };

        let tasks = JSON.parse(localStorage.getItem('pro_tasks')) || [];
        let currentPage = 'timeline';
        let currentCat = null;
        let timelineFilter = 'sve';

        // --- APP LOGIC ---
        const app = {
            setPage(page, cat = null) {
                currentPage = page;
                currentCat = cat;
                document.querySelectorAll('.nav-item').forEach((el, i) => {
                    el.classList.toggle('active', (page === 'timeline' && i === 0) || ((page === 'categories' || page === 'category') && i === 1) || (page === 'archive' && i === 2));
                });
                this.render();
            },

            saveTask() {
                const desc = document.getElementById('task-desc').value;
                if (!desc) return;
                const id = document.getElementById('task-id').value;
                const task = {
                    id: id || Date.now().toString(),
                    desc,
                    cat: document.getElementById('task-cat').value,
                    date: document.getElementById('task-date').value,
                    priority: document.getElementById('task-priority').value,
                    done: false
                };
                if (id) {
                    const idx = tasks.findIndex(t => t.id === id);
                    task.done = tasks[idx].done;
                    tasks[idx] = task;
                } else {
                    tasks.push(task);
                }
                this.sync();
                ui.closeModal();
            },

            toggleTask(id, e) {
                e.stopPropagation();
                const t = tasks.find(x => x.id === id);
                t.done = !t.done;
                this.sync();
            },

            deleteTask() {
                if (!confirm('Obri≈°i?')) return;
                const id = document.getElementById('task-id').value;
                tasks = tasks.filter(t => t.id !== id);
                this.sync();
                ui.closeModal();
            },

            sync() {
                localStorage.setItem('pro_tasks', JSON.stringify(tasks));
                this.render();
            },

            render() {
                const shell = document.getElementById('app-shell');
                const title = document.getElementById('header-title');
                const count = document.getElementById('total-count');
                count.innerText = tasks.filter(t => !t.done).length;
                shell.innerHTML = '';

                if (currentPage === 'timeline') {
                    title.innerText = 'TIMELINE';
                    this.renderTimeline(shell);
                } else if (currentPage === 'categories') {
                    title.innerText = 'KATEGORIJE';
                    this.renderGrid(shell);
                } else if (currentPage === 'category') {
                    title.innerText = CATS[currentCat].n.toUpperCase();
                    this.renderCategory(shell);
                } else if (currentPage === 'archive') {
                    title.innerText = 'ARHIVA';
                    this.renderArchive(shell);
                }
            },

            renderTimeline(el) {
                const today = new Date().toISOString().split('T')[0];
                let active = tasks.filter(t => !t.done && t.date);
                
                if(timelineFilter === 'danas') active = active.filter(t => t.date === today);
                if(timelineFilter === 'hitno') active = active.filter(t => t.priority === 'hitno');

                el.innerHTML = `
                    <div class="filters">
                        <div class="filter-btn ${timelineFilter==='sve'?'active':''}" onclick="app.setFilter('sve')">Sve</div>
                        <div class="filter-btn ${timelineFilter==='danas'?'active':''}" onclick="app.setFilter('danas')">Danas</div>
                        <div class="filter-btn ${timelineFilter==='hitno'?'active':''}" onclick="app.setFilter('hitno')">üö® Hitno</div>
                    </div>
                `;

                const overdue = active.filter(t => t.date < today);
                const isToday = active.filter(t => t.date === today);
                const upcoming = active.filter(t => t.date > today);

                if (overdue.length) el.innerHTML += `<div class="section-title bebas">KASNI</div>` + overdue.map(t => this.taskHTML(t)).join('');
                if (isToday.length) el.innerHTML += `<div class="section-title bebas">DANAS</div>` + isToday.map(t => this.taskHTML(t)).join('');
                if (upcoming.length) el.innerHTML += `<div class="section-title bebas">USKORO</div>` + upcoming.map(t => this.taskHTML(t)).join('');
                
                if (!active.length) el.innerHTML += `<div style="text-align:center; padding:40px; color:var(--muted)">Nema zadataka sa rokom.</div>`;
            },

            renderGrid(el) {
                let html = '<div class="grid">';
                for (let k in CATS) {
                    const c = tasks.filter(t => t.cat === k && !t.done).length;
                    html += `
                        <div class="cat-card" onclick="app.setPage('category', '${k}')">
                            ${c > 0 ? `<div class="cat-badge">${c}</div>` : ''}
                            <i>${CATS[k].i}</i>
                            <div class="cat-name">${CATS[k].n}</div>
                        </div>`;
                }
                el.innerHTML = html + '</div>';
            },

            renderCategory(el) {
                const catTasks = tasks.filter(t => t.cat === currentCat && !t.done);
                el.innerHTML = catTasks.length ? catTasks.map(t => this.taskHTML(t)).join('') : '<div style="text-align:center; padding:40px; color:var(--muted)">Kategorija je prazna.</div>';
            },

            renderArchive(el) {
                const done = tasks.filter(t => t.done);
                el.innerHTML = done.length ? done.slice(-30).reverse().map(t => this.taskHTML(t)).join('') : '<div style="text-align:center; padding:40px; color:var(--muted)">Arhiva je prazna.</div>';
            },

            setFilter(f) { timelineFilter = f; this.render(); },

            taskHTML(t) {
                const today = new Date().toISOString().split('T')[0];
                const dateStatus = t.date < today ? 'overdue' : (t.date === today ? 'today' : '');
                return `
                    <div class="task-card" style="border-left-color:${CATS[t.cat].c}; opacity:${t.done?0.5:1}" onclick="ui.openModal('${t.id}')">
                        <div style="display:flex; justify-content:space-between;">
                            <div class="task-desc" style="${t.done?'text-decoration:line-through':''}">${t.desc}</div>
                            <input type="checkbox" ${t.done?'checked':''} onclick="app.toggleTask('${t.id}', event)">
                        </div>
                        <div class="task-meta">
                            <span>${CATS[t.cat].i} ${CATS[t.cat].n}</span>
                            ${t.date ? `<span class="date-badge ${dateStatus}">${t.date.split('-')[2]}.${t.date.split('-')[1]}.</span>` : ''}
                            ${t.priority === 'hitno' ? `<span class="priority-hitno">üö® HITNO</span>` : ''}
                        </div>
                    </div>`;
            }
        };

        // --- UI UI ---
        const ui = {
            openModal(id = null) {
                const catSel = document.getElementById('task-cat');
                catSel.innerHTML = Object.entries(CATS).map(([k,v]) => `<option value="${k}" ${currentCat===k?'selected':''}>${v.i} ${v.n}</option>`).join('');
                
                if (id) {
                    const t = tasks.find(x => x.id === id);
                    document.getElementById('task-id').value = t.id;
                    document.getElementById('task-desc').value = t.desc;
                    document.getElementById('task-cat').value = t.cat;
                    document.getElementById('task-date').value = t.date;
                    document.getElementById('task-priority').value = t.priority;
                    document.getElementById('modal-heading').innerText = 'Izmeni Zadatak';
                    document.getElementById('del-btn').style.display = 'block';
                } else {
                    document.getElementById('task-id').value = '';
                    document.getElementById('task-desc').value = '';
                    document.getElementById('task-date').value = '';
                    document.getElementById('task-priority').value = 'normal';
                    document.getElementById('modal-heading').innerText = 'Novi Zadatak';
                    document.getElementById('del-btn').style.display = 'none';
                }
                document.getElementById('modal-overlay').classList.add('open');
            },
            closeModal() { document.getElementById('modal-overlay').classList.remove('open'); }
        };

        // Init
        app.render();

        // PWA Registracija
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(console.error);
            });
        }
    </script>
</body>
</html>